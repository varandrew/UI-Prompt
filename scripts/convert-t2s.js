#!/usr/bin/env node

/**
 * Script to convert Traditional Chinese to Simplified Chinese in markdown files
 * Uses a mapping table for common characters
 */

import fs from 'fs';
import path from 'path';
import { execSync } from 'child_process';

// Common Traditional to Simplified Chinese mapping
const t2sMap = {
  // Common characters in prompts
  '設計': '设计',
  '設定': '设定',
  '視覺': '视觉',
  '實現': '实现',
  '應該': '应该',
  '強調': '强调',
  '擅長': '擅长',
  '風格': '风格',
  '關鍵': '关键',
  '層次': '层次',
  '執行': '执行',
  '導航': '导航',
  '內容': '内容',
  '佈局': '布局',
  '網格': '网格',
  '響應': '响应',
  '標題': '标题',
  '標籤': '标签',
  '圖像': '图像',
  '組件': '组件',
  '動效': '动效',
  '動畫': '动画',
  '過渡': '过渡',
  '懸停': '悬停',
  '點擊': '点击',
  '聚焦': '聚焦',
  '訪問': '访问',
  '對比': '对比',
  '調色': '调色',
  '調': '调',
  '變量': '变量',
  '變': '变',
  '邊': '边',
  '邊框': '边框',
  '陰影': '阴影',
  '顯示': '显示',
  '緩': '缓',
  '緩動': '缓动',
  '間距': '间距',
  '間': '间',
  '觸控': '触控',
  '優先': '优先',
  '優': '优',
  '確保': '确保',
  '確': '确',
  '禁用': '禁用',
  '禁': '禁',
  '啟用': '启用',
  '處理': '处理',
  '處': '处',
  '覆': '覆',
  '蓋': '盖',
  '覆蓋': '覆盖',
  '遮罩': '遮罩',
  '紋理': '纹理',
  '紋': '纹',
  '質感': '质感',
  '質': '质',
  '極': '极',
  '極簡': '极简',
  '極致': '极致',
  '專注': '专注',
  '專': '专',
  '現代': '现代',
  '現': '现',
  '營造': '营造',
  '營': '营',
  '體驗': '体验',
  '體': '体',
  '選': '选',
  '選擇': '选择',
  '適': '适',
  '適用': '适用',
  '適合': '适合',
  '環': '环',
  '環境': '环境',
  '環形': '环形',
  '環狀': '环状',
  '場景': '场景',
  '場': '场',
  '縮放': '缩放',
  '縮': '缩',
  '輕': '轻',
  '輕微': '轻微',
  '轉': '转',
  '轉換': '转换',
  '轉變': '转变',
  '進': '进',
  '進行': '进行',
  '進度': '进度',
  '達': '达',
  '達成': '达成',
  '達到': '达到',
  '還': '还',
  '還原': '还原',
  '還需': '还需',
  '這': '这',
  '這個': '这个',
  '這樣': '这样',
  '這些': '这些',
  '這種': '这种',
  '這裡': '这里',
  '這是': '这是',
  '個': '个',
  '個人': '个人',
  '個性': '个性',
  '樣': '样',
  '樣式': '样式',
  '樣式表': '样式表',
  '樣品': '样品',
  '樣本': '样本',
  '讓': '让',
  '讓用戶': '让用户',
  '讓用户': '让用户',
  '讓使用者': '让使用者',
  '讓頁面': '让页面',
  '讓页面': '让页面',
  '當': '当',
  '當前': '当前',
  '當用戶': '当用户',
  '當用户': '当用户',
  '當使用者': '当使用者',
  '當頁面': '当页面',
  '當页面': '当页面',
  '為': '为',
  '為了': '为了',
  '為用戶': '为用户',
  '為用户': '为用户',
  '為頁面': '为页面',
  '為页面': '为页面',
  '著': '着',
  '著重': '着重',
  '資': '资',
  '資源': '资源',
  '資訊': '资讯',
  '資料': '资料',
  '資產': '资产',
  '産': '产',
  '産品': '产品',
  '產': '产',
  '產品': '产品',
  '產生': '产生',
  '產出': '产出',
  '頁': '页',
  '頁面': '页面',
  '頂': '顶',
  '頂部': '顶部',
  '頂端': '顶端',
  '項': '项',
  '項目': '项目',
  '項目管理': '项目管理',
  '須': '须',
  '須要': '须要',
  '須知': '须知',
  '預': '预',
  '預設': '预设',
  '預覽': '预览',
  '預測': '预测',
  '預留': '预留',
  '預先': '预先',
  '預期': '预期',
  '預約': '预约',
  '預計': '预计',
  '類': '类',
  '類型': '类型',
  '類別': '类别',
  '類似': '类似',
  '類名': '类名',
  '類比': '类比',
  '護': '护',
  '護照': '护照',
  '護衛': '护卫',
  '護理': '护理',
  '聲': '声',
  '聲音': '声音',
  '聲明': '声明',
  '學': '学',
  '學習': '学习',
  '學校': '学校',
  '學院': '学院',
  '學生': '学生',
  '學術': '学术',
  '會': '会',
  '會話': '会话',
  '會議': '会议',
  '會員': '会员',
  '測': '测',
  '測試': '测试',
  '測量': '测量',
  '測驗': '测验',
  '測定': '测定',
  '動': '动',
  '動態': '动态',
  '動作': '动作',
  '動力': '动力',
  '動機': '动机',
  '動能': '动能',
  '動線': '动线',
  '動畫': '动画',
  '綫': '线',
  '綫條': '线条',
  '綫性': '线性',
  '線': '线',
  '線條': '线条',
  '線性': '线性',
  '線框': '线框',
  '線寬': '线宽',
  '線段': '线段',
  '線路': '线路',
  '總': '总',
  '總體': '总体',
  '總共': '总共',
  '總和': '总和',
  '總計': '总计',
  '總是': '总是',
  '總結': '总结',
  '總覽': '总览',
  '總之': '总之',
  '師': '师',
  '師範': '师范',
  '師傅': '师傅',
  '師父': '师父',
  '師生': '师生',
  '師資': '师资',
  '師長': '师长',
  '準': '准',
  '準備': '准备',
  '準確': '准确',
  '準則': '准则',
  '準時': '准时',
  '標': '标',
  '標準': '标准',
  '標記': '标记',
  '標誌': '标志',
  '標識': '标识',
  '標示': '标示',
  '標注': '标注',
  '標籤': '标签',
  '標題': '标题',
  '標語': '标语',
  '標點': '标点',
  '標簽': '标签',
  '樓': '楼',
  '樓層': '楼层',
  '樓梯': '楼梯',
  '樓盤': '楼盘',
  '樓上': '楼上',
  '樓下': '楼下',
  '樓房': '楼房',
  '機': '机',
  '機會': '机会',
  '機器': '机器',
  '機制': '机制',
  '機構': '机构',
  '機能': '机能',
  '機械': '机械',
  '機關': '机关',
  '機場': '机场',
  '歐': '欧',
  '歐洲': '欧洲',
  '歐元': '欧元',
  '歐盟': '欧盟',
  '歐美': '欧美',
  '歐式': '欧式',
  '歷': '历',
  '歷史': '历史',
  '歷程': '历程',
  '歷來': '历来',
  '歷經': '历经',
  '歷年': '历年',
  '歷屆': '历届',
  '歸': '归',
  '歸納': '归纳',
  '歸類': '归类',
  '歸屬': '归属',
  '歸檔': '归档',
  '歸還': '归还',
  '歸位': '归位',
  '歸零': '归零',
  '殘': '残',
  '殘留': '残留',
  '殘缺': '残缺',
  '殘疾': '残疾',
  '殘障': '残障',
  '殘餘': '残余',
  '殺': '杀',
  '殺毒': '杀毒',
  '殺菌': '杀菌',
  '殺傷': '杀伤',
  '殺害': '杀害',
  '殺死': '杀死',
  '氣': '气',
  '氣氛': '气氛',
  '氣息': '气息',
  '氣質': '气质',
  '氣候': '气候',
  '氣溫': '气温',
  '氣體': '气体',
  '氣味': '气味',
  '氣勢': '气势',
  '決': '决',
  '決定': '决定',
  '決策': '决策',
  '決議': '决议',
  '決賽': '决赛',
  '決心': '决心',
  '決斷': '决断',
  '沒': '没',
  '沒有': '没有',
  '沒關係': '没关系',
  '沒問題': '没问题',
  '沒什麼': '没什么',
  '沒辦法': '没办法',
  '沒錯': '没错',
  '滿': '满',
  '滿足': '满足',
  '滿意': '满意',
  '滿載': '满载',
  '滿分': '满分',
  '滿額': '满额',
  '滿月': '满月',
  '溝': '沟',
  '溝通': '沟通',
  '溝渠': '沟渠',
  '溝壑': '沟壑',
  '準': '准',
  '準則': '准则',
  '準確': '准确',
  '準時': '准时',
  '準備': '准备',
  '準許': '准许',
  '濾': '滤',
  '濾鏡': '滤镜',
  '濾波': '滤波',
  '濾網': '滤网',
  '濾清': '滤清',
  '濾色': '滤色',
  '瀏': '浏',
  '瀏覽': '浏览',
  '瀏覽器': '浏览器',
  '無': '无',
  '無法': '无法',
  '無論': '无论',
  '無限': '无限',
  '無窮': '无穷',
  '無效': '无效',
  '無需': '无需',
  '無縫': '无缝',
  '無關': '无关',
  '營': '营',
  '營業': '营业',
  '營銷': '营销',
  '營養': '营养',
  '營運': '营运',
  '營造': '营造',
  '營地': '营地',
  '環': '环',
  '環境': '环境',
  '環保': '环保',
  '環節': '环节',
  '環繞': '环绕',
  '環形': '环形',
  '環狀': '环状',
  '環球': '环球',
  '狀': '状',
  '狀態': '状态',
  '狀況': '状况',
  '狀態欄': '状态栏'
};

function convertText(text) {
  let result = text;

  // Sort by length (longer first) to handle multi-character mappings first
  const sortedKeys = Object.keys(t2sMap).sort((a, b) => b.length - a.length);

  for (const trad of sortedKeys) {
    const simp = t2sMap[trad];
    const regex = new RegExp(trad, 'g');
    result = result.replace(regex, simp);
  }

  return result;
}

function processFile(filePath) {
  try {
    const content = fs.readFileSync(filePath, 'utf8');
    const converted = convertText(content);

    if (content !== converted) {
      fs.writeFileSync(filePath, converted, 'utf8');
      console.log(`✓ Converted: ${filePath}`);
      return true;
    } else {
      console.log(`- Unchanged: ${filePath}`);
      return false;
    }
  } catch (error) {
    console.error(`✗ Error processing ${filePath}:`, error.message);
    return false;
  }
}

function findAndConvertFiles(dir) {
  const files = execSync(`find "${dir}" -name "*.md" -type f`, { encoding: 'utf8' })
    .trim()
    .split('\n')
    .filter(Boolean);

  console.log(`Found ${files.length} markdown files\n`);

  let converted = 0;
  let unchanged = 0;

  for (const file of files) {
    if (processFile(file)) {
      converted++;
    } else {
      unchanged++;
    }
  }

  console.log(`\n✓ Conversion complete!`);
  console.log(`  Converted: ${converted} files`);
  console.log(`  Unchanged: ${unchanged} files`);
}

// Main execution
const targetDir = process.argv[2] || 'public/data/prompts';
console.log(`Converting Traditional Chinese to Simplified Chinese in: ${targetDir}\n`);
findAndConvertFiles(targetDir);
